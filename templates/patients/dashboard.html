{% extends 'base.html' %}
{% block title %}Dashboard | MEDTRACK{% endblock %}
{% block content %}
<h1 class="h3 mb-3">Dashboard</h1>
<div class="row g-3 mb-4">
  <div class="col-6 col-md-2"><div class="card"><div class="card-body"><small>Today's Tasks</small><div class="h4">{{ today_tasks|length }}</div></div></div></div>
  <div class="col-6 col-md-2"><div class="card"><div class="card-body"><small>Upcoming</small><div class="h4">{{ upcoming_tasks|length }}</div></div></div></div>
  <div class="col-6 col-md-2"><div class="card"><div class="card-body"><small>Overdue</small><div class="h4 text-danger">{{ overdue_tasks|length }}</div></div></div></div>
  <div class="col-6 col-md-2"><div class="card"><div class="card-body"><small>Awaiting</small><div class="h4">{{ awaiting_tasks|length }}</div></div></div></div>
  <div class="col-6 col-md-2"><div class="card"><div class="card-body"><small>Red List</small><div class="h4 text-danger">{{ red_list_count }}</div></div></div></div>
  <div class="col-6 col-md-2"><div class="card"><div class="card-body"><small>Grey List</small><div class="h4 text-secondary">{{ grey_list_count }}</div></div></div></div>
</div>

<div class="row g-4">
  <div class="col-lg-6">
    <h2 class="h5">Today's Tasks</h2>
    <ul class="list-group mb-3">
      {% for task in today_tasks %}<li class="list-group-item"><a href="{% url 'patients:case_detail' task.case_id %}">{{ task.case.uhid }}</a> — {{ task.title }} ({{ task.due_date }})</li>{% empty %}<li class="list-group-item">No tasks due today.</li>{% endfor %}
    </ul>
    <h2 class="h5">Upcoming ({{ upcoming_days }} days)</h2>
    <ul class="list-group">
      {% for task in upcoming_tasks %}<li class="list-group-item">{{ task.due_date }} — <a href="{% url 'patients:case_detail' task.case_id %}">{{ task.case.patient_name }}</a> / {{ task.title }}</li>{% empty %}<li class="list-group-item">No upcoming tasks.</li>{% endfor %}
    </ul>
  </div>
  <div class="col-lg-6">
    <h2 class="h5">Overdue Tasks</h2>
    <ul class="list-group mb-3">
      {% for task in overdue_tasks %}<li class="list-group-item">{{ task.due_date }} — <a href="{% url 'patients:case_detail' task.case_id %}">{{ task.case.uhid }}</a> / {{ task.title }}</li>{% empty %}<li class="list-group-item">No overdue tasks.</li>{% endfor %}
    </ul>
    <h2 class="h5">Awaiting Reports</h2>
    <ul class="list-group">
      {% for task in awaiting_tasks %}<li class="list-group-item"><a href="{% url 'patients:case_detail' task.case_id %}">{{ task.case.patient_name }}</a> — {{ task.title }}</li>{% empty %}<li class="list-group-item">No awaiting-report tasks.</li>{% endfor %}
    </ul>
    <p class="mt-3 mb-0"><strong>Cases:</strong> Active {{ active_case_count }} · Completed {{ completed_case_count }}</p>
  </div>
</div>
{% endblock %}
